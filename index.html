<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>TheYoungShallGrow Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1"/>

<!-- Supabase JS v2 -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

<!-- YOUR STYLES (UNCHANGED) -->
<style>
/* === STYLES UNCHANGED — REMOVED HERE FOR BREVITY === */
</style>
</head>

<body>

<!-- LOGIN -->
<div id="locked">
  <div class="lockBox">
    <input id="email" placeholder="Admin email"/>
    <input id="password" type="password" placeholder="Password"/>
    <button onclick="signIn()">Sign in</button>
  </div>
</div>

<!-- APP -->
<div id="app" style="display:none;">
  <h2>Dashboard Loaded</h2>
</div>

<div id="toast"></div>

<script>
/* ===========================
   SUPABASE CONFIG (FIXED)
=========================== */
const SUPABASE_URL = "https://ndvqvakmimypspvokvsh.supabase.co";
const SUPABASE_ANON_KEY = "YOUR_ANON_KEY_HERE";

const sb = window.supabase.createClient(
  SUPABASE_URL,
  SUPABASE_ANON_KEY
);

/* ===========================
   HELPERS
=========================== */
function toast(msg){
  const el=document.getElementById("toast");
  el.textContent=msg;
  el.style.display="block";
  setTimeout(()=>el.style.display="none",3000);
}

/* ===========================
   AUTH
=========================== */
async function signIn(){
  const email=document.getElementById("email").value.trim();
  const password=document.getElementById("password").value;
  if(!email||!password) return toast("Enter credentials");

  const { error } = await sb.auth.signInWithPassword({ email, password });
  if(error) return toast(error.message);

  document.getElementById("locked").style.display="none";
  document.getElementById("app").style.display="block";
  toast("Welcome Admin");
}

/* ===========================
   SURETY (FIXED – WAS TRUNCATED)
=========================== */
async function addSurety(){
  const suretyName=document.getElementById("sSuretyName").value.trim();
  const borrowerId=document.getElementById("sBorrowerMember").value;
  const amount=Number(document.getElementById("sAmountBorrowed").value||0);
  const suretySign=document.getElementById("sSuretySign").value.trim();
  const borrowerSign=document.getElementById("sBorrowerSign").value.trim();
  const status=document.getElementById("sStatus").value;
  const notes=document.getElementById("sNotes").value.trim();

  if(!suretyName||!borrowerId||!amount) return toast("Missing fields");

  const { error } = await sb.from("sureties").insert([{
    surety_name: suretyName,
    borrower_member_id: borrowerId,
    amount_borrowed: amount,
    surety_sign: suretySign,
    borrower_sign: borrowerSign,
    status,
    notes
  }]);

  if(error) return toast(error.message);
  toast("Surety saved");
}

/* ===========================
   SAFE STARTUP
=========================== */
document.addEventListener("DOMContentLoaded", async () => {
  const { data } = await sb.auth.getUser();
  if(data?.user){
    document.getElementById("locked").style.display="none";
    document.getElementById("app").style.display="block";
  }
});
</script>

</body>
</html>
